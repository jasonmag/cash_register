<h1 class="text-2xl font-bold mb-6">Your Cart</h1>

<% total = 0 %>

<div class="space-y-4">
  <% @cart_items.each do |item| %>
    <% product = item[:product] %>
    <% qty = item[:quantity] %>
    <% billed_qty = item[:billed_quantity] %>
    <% unit_price = item[:price_per_unit] %>
    <% item_total = item[:total_price] %>
    <% total += item_total %>

    <div class="p-4 bg-white rounded shadow flex justify-between items-center">
      <div>
        <p class="font-medium"><%= product.name %> (<%= product.product_code %>)</p>
        <p class="text-sm text-gray-500">Qty: <%= qty %> | Charged: <%= billed_qty %></p>

        <% if product.bogo? && qty > billed_qty %>
          <p class="text-xs text-green-500">BOGO applied</p>
        <% end %>

        <% if product.bulk_quantity && qty >= product.bulk_quantity && product.bulk_price %>
          <p class="text-xs text-yellow-600">Bulk price applied: €<%= product.bulk_price %></p>
        <% end %>

        <% if product.percent_discount && qty >= 3 %>
          <p class="text-xs text-purple-600"><%= product.percent_discount %>% discount applied</p>
        <% end %>
      </div>
      <div class="text-right">
        <p class="text-sm font-semibold">€<%= number_with_precision(item_total, precision: 2) %></p>
      </div>
    </div>
  <% end %>
</div>

<hr class="my-6">

<p class="text-lg font-semibold">Total: €<%= number_with_precision(total, precision: 2) %></p>

<%= link_to "Back to Products", root_path, class: "text-blue-600 hover:underline mt-6 inline-block" %>
